# Basic-of-IoT
Multi device connection to Arduino UNO R3

Demo video(My youtube channel):https://www.youtube.com/watch?v=ClGRAUeKvUw

這篇所使用的元件：

1. 伺服馬達( Servo ) ─ SG90

2. 繼電器( Relay ) ─ SRD-05VDC-SL-C

3. 溫濕度感測器 ─ DHT11

4. 紅外線接收器( Infrared )

5. 4 x 4薄膜矩陣鍵盤(4x4 Matrix Keypad)

6. 蘑菇頭搖桿 ( Joystick、PS4的類比搖桿 )

7. 液晶顯示器 ─ 1602 I2C


本篇不著重介紹各個元件，但施作遇到的bottleneck(瓶頸)會做說明和解釋。


![image](https://github.com/howard396501/Basic-of-IoT/blob/master/BasicIoT_bb.jpg)


![image](https://github.com/howard396501/Basic-of-IoT/blob/master/demo%20picture/00_demo%20product.JPG)

實體圖多了遙控器，這個遙控器的功能跟鍵盤一樣，按下上面的數字會在液晶顯示器上顯示你使用某一元件(裝置)的狀態

這個系統主要連接了三個元件(裝置)和五種顯示狀態：
  
  三個元件(裝置)：
  
  1. 溫濕度感測器
  
  2. 繼電器
  
  3. 伺服馬達
  
  五種顯示狀態：
  
  1. Waiting Command. →預設 或 按下"0"
  
  2. 溫度 和 濕度 → 按下"1"
  
  3. 繼電器打開 → 按下"2"
  
  4. 繼電器關閉 → 按下"3"
  
  5. 伺服馬達旋轉角度 → 按下"4"
  
  
  
  因為Arduino本身接腳的數量有限，連接這三個元件(裝置)已經到了硬體極限，消耗掉所有可使用的Arduino本體的腳位，大部分接腳都消耗在4x4薄  膜矩陣鍵盤，不過因為其矩陣鍵盤的內部線路特性，實體接線還可以再減化，如果有機會把這個系統進行擴充再做簡化的動作。



【Bottleneck】

施作過程中遇到問題不少，耗費大量時間去Try & Error，還有上網survey(調查)一些資料來讀，基本上都解決了，問題分別有硬體問題和軟體問題，在此條列式出問題點：


﹝硬體問題﹞

1. Arduino主版有時候會燒錄失敗，重新插拔即可解決〈燒錄失敗原因這個網站有列很多，可參考：http://yehnan.blogspot.tw/2014/10/arduinostk500getsync-not-in-sync.html〉。

2. 液晶顯示器有時候會不正常顯示，重新插拔Arduino(重新供電)或重新燒錄也可以解決。

3. 如果你已經使用序列通訊(Digital上非Pin1和Pin0之通訊埠)，Arduino主板上的Digital Pin1(TX)和Pin0(RX)不可以亂用，我唯一有用到這兩個角位的時候是在施作藍芽模組。

4. 紅外線接收器在接收訊號會被伺服馬達影響，如果開出Serial Monitor來看(要寫相關Code)，會發現伺服馬達在運轉的時候，紅外線接收到的Decode狀態是"-1"(解碼失敗)，多按幾次就可以搞定了。

5. 沒有伺服馬達，紅外線接收非常準。


﹝軟體問題﹞

1. 鍵盤掃描判斷之訊號是使用其解碼前的代碼，而非字元！〈上次上課有很多同學因此卡住很久〉，鍵盤上的代碼都是由ASCII編碼而成，網路上有其表，這裡就不放了。〈我自己是用16進制作判讀，上次上課有同學轉成10進制也是聰明的做法〉。

2. 紅外線按下的判斷可以寫成一個副程式去處理，當然首先要在void loop()裡先判讀是否接收到訊號。

3. 紅外線訊號的判斷也是用代碼，要寫出可以知道按鈕代碼的code(程式碼)，當然代碼在網路上也找的到，但我還是encourage(鼓勵)用code寫出來會比較有意思。

4. 伺服馬達的操作不可以單純寫成一個IF去開啟其功能，因為伺服馬達的工作是持續性的，如果寫成IF啟動而不再作任何改寫，那伺服馬達只會短暫做一次工作而已，你要一直不停的按"4"才會看的出來問題所在。

5. 延續上面，我曾經在主程式的IF判斷式裡面多加了while(1)〈無窮迴圈〉去讓伺服馬達不斷工作，但是失敗收場，後來改寫成副程式就好了！改寫成副程式就好了！！改寫成副程式就好了！！！我也不知道為什麼，有機會再來debug。

6. 每次在按下按鍵，液晶顯示氣都會顯示各種裝置的狀態，這代表每次都要把畫面清空，不要忘了使用「lcd.clear();」這條指令。

7. 伺服馬達的lcd.clear();不可以在無窮迴圈裡，否則你會看到很驚人的結果...！

8. 無窮迴圈記得要用條件和判斷式去break掉。

9. 因為液晶顯示器畫面在顯示後會自動殘留(記憶)，所以可以用「空格」lcd.print(" ")來處理你的畫面〈比如說伺服馬達旋轉角度的數字〉。


【可改進之地方】

這邊也分成硬體和軟體兩部分去做說明，可能受限於自己技術頗爛的關係，我需要比較足夠的硬體支持才能去撰寫軟體，沒辦法從軟體去根除硬體不夠用的狀況：


﹝硬體改善﹞

1. 薄膜鍵盤因其構造可以再簡化接線。詳細可參考：https://swf.com.tw/?p=921

2. 薄膜鍵盤佔用太多port，簡化後可以再掛上更多裝置。


﹝軟體改善﹞
1. 因為硬體已使用到極限，我在施作伺服馬達因為開關需要多一個port去做判讀(簡單裝一個LED上去做為判斷媒介即可)紅外線因為接收會造成伺服馬達工作有問題的情況〈上面〝軟體問題〞的第四點和第五點已被我更改回只工作一次的情況，如果語句言不及義，可參考Code會比較清楚我在說什麼，副程式已經被我修掉〉，不過port已經被我完全使用完，這可能要等待硬體改善完成後才有機會釋出比較多的port讓我去處理這個問題。


2. 溫濕度感測因為IF判斷式的關係，也只能工作一次，我窮盡手段要讓他可以線性工作，但是遭遇鍵盤和紅外線按鈕判讀上的問題，這當然也是只能透過軟體去改善，或許還要再使用一個port去做判斷媒介，情況同上述第一點。


